# 当前前端存在的一些问题

1. 当前主流 vue、react 框架均为单页应用，修改一个很小的功能却需要打包、编译、发布整个项目，对于比较庞大的项目，成本较高
2. 对于一些老旧项目(jQuery)，如果想使用 react 或者 vue 进行开发，需要对之前的项目进行重构
3. 当前的单页应用，所有 js 最后都会打包到一个 bundle.js 文件中，这会导致线上用户第一次进入的时间比较长，对于前端性能统计中的 FP、FCP、TTI 等一系列指标产生重大影响。（虽然可以使用懒加载的形式对代码进行拆分，但仍然会有上述问题，因为懒加载是在路由发生变化的时候去加载的，当切换路由时，仍然需要动态获取相应模块的代码资源，其中也会有损耗）

# 希望解决上述问题的技术可以做到？

1. 使各个子模块或者子系统进行隔离，这样在更新一个子模块的时候，我们只需要对这个子模块进行打包，发布上线，不会影响到其他模块。并且由于各个子系统之间相互隔离，项目就会被拆分得轻量化，打包速度、前端性能等也会上去。并且因为各个子系统之间的相互隔离，不会受限于技术栈，子系统只需要关注自身功能就可以
2. 可以使各个子系统进行数据共享，如用户信息
3. 能够对 js、css 进行相互隔离，防止出现污染问题

# 微前端

将 Web 应用由单一的单页应用转变为由多个小型前端应用聚合的应用。并且每个前端应用还可以独立运行、开发、部署（独立！！！）

## 实现方案

1. 路由转发：将路由跳转交给服务端，当访问一个路由时，由后端进行重定向，可以不受技术栈的限制，并且由于符合同源策略，可以通过 cookie 传递信息，
   并且每次切换路由的时候，都会重新加载页面，也实现了 js、css 的隔离

优点：简单、可快速配置
缺点：每次跳转都相当于重新刷新一次页面，而不是页面内进行跳转，影响性能

2. iframe 嵌套：父程序监听路由的变化，加载或卸载相应的子程序 iframe，每一个 iframe 相当于一个独立的页面，具有天然的 js、css 隔离，信息共享方面可以使用 postMessage 或 contentWindow 进行通信

优点：实现简单、自带沙盒特性
缺点：
· 业务兼容性问题（比如在子应用内需要实现的全局弹窗，需要 postMessage 通知父应用，实现复杂）
· 主应用劫持快捷键操作
· 事件无法冒泡至顶层（主应用）
· iframe 内元素会被限制在文档树中，视窗宽高限制问题
· 无法共享基础库进一步减少包体积
· 事件通信繁琐且限制多 （iframe 通信总结 https://blog.csdn.net/willspace/article/details/49003963）

3. Web Components（创建可复用的定制元素并使用 Custom Elements | Shadow DOM | HTML templates），将每个子应用采用 web components 进行开发，纯 web-components 相当于自定义一个 html 标签，可以注入到任意框架中去使用（使用较少）

优点：每个子应用拥有独立的 script 和 css，可以单独部署
确定：对之前的子系统改造成本较高，通信复杂

4. 组合式应用路由分发
